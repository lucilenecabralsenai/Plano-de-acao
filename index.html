<!doctype html>
<html lang="pt-BR" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Plano de A√ß√£o</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
body {
  box-sizing: border-box;
}
   .cabecalho{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:20px;
  background:#003b71;
  padding:15px 20px;
  border-radius:15px;
  margin-bottom:20px;
  color:white;
}

.logo-senai{
  height:60px;
  background:white;
  padding:8px 12px;
  border-radius:10px;
}

@import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap');

.app-container {
  font-family: 'Plus Jakarta Sans', sans-serif;
}

.editable-cell {
  min-height: 40px;
  outline: none;
  transition: background-color 0.2s ease;
}

.editable-cell:focus {
  background-color: #fef3c7 !important;
}

.editable-cell:empty:before {
  content: attr(data-placeholder);
  color: #9ca3af;
}

@media print {
  .no-print {
    display: none !important;
  }
}
</style>
  <script src="https://cdn.tailwindcss.com/3.4.17" type="text/javascript"></script>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full m-0 p-0">
  <div class="app-container h-full w-full overflow-auto" id="main-container" style="background-color: #f8fafc;">
   <div class="max-w-4xl mx-auto p-6 md:p-10"><!-- Header -->
    <div class="text-center mb-8">
     <div class="inline-flex items-center justify-center w-16 h-16 rounded-2xl mb-4" style="background-color: #1e3a5f;">
      <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path>
      </svg>
     </div>
     <div class="cabecalho">
  <img src="imagens/logo-senai.png" alt="Logo SENAI" class="logo-senai">
  <h1 id="document-title" class="text-3xl md:text-4xl font-bold mb-0">
    PLANO DE A√á√ÉO
  </h1>
</div>
     <div class="w-24 h-1 mx-auto rounded-full" style="background-color: #3b82f6;"></div>
    </div><!-- Escopo Section -->
    <div class="rounded-2xl shadow-lg mb-8 overflow-hidden" style="background-color: #ffffff; border: 2px solid #e2e8f0;">
     <div class="px-6 py-4" style="background-color: #1e3a5f;">
      <h3 class="text-lg font-semibold text-white flex items-center gap-2">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
       </svg> ESCOPO DO SERVI√áO</h3>
     </div>
     <div class="p-6">
      <div id="escopo-content" contenteditable="true" class="editable-cell p-4 rounded-xl min-h-[100px]" style="background-color: #f1f5f9; color: #334155;" data-placeholder="Descreva o escopo do servi√ßo aqui..." onkeydown="handleEscopoKeydown(event)">
       <p>‚Ä¢ Escreva aqui o escopo do servi√ßo;</p>
      </div>
     </div>
    </div><!-- Objetivo Section -->
    <div class="rounded-2xl shadow-lg mb-8 p-6" style="background-color: #ffffff; border: 2px solid #e2e8f0;">
     <div class="flex items-start gap-4">
      <div class="flex-shrink-0 w-12 h-12 rounded-xl flex items-center justify-center" style="background-color: #dbeafe;">
       <svg class="w-6 h-6" style="color: #3b82f6;" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
       </svg>
      </div>
      <div class="flex-grow">
       <h4 class="font-semibold text-lg mb-1" style="color: #1e3a5f;">Objetivo</h4>
       <p id="objective-text" contenteditable="true" class="leading-relaxed p-3 rounded-lg cursor-text transition-colors hover:bg-blue-50 focus:bg-blue-50" style="color: #64748b; background-color: #f8fafc;" onblur="updateObjective(event)">Realizar plano de trabalho de atividades na empresa acordado entre as partes (prestadora de servi√ßo e empresa demandante).</p>
      </div>
     </div>
    </div><!-- Tabela Section -->
    <div class="rounded-2xl shadow-lg mb-8 overflow-hidden" style="background-color: #ffffff; border: 2px solid #e2e8f0;">
     <div class="px-6 py-4 flex items-center justify-between" style="background-color: #1e3a5f;">
      <h3 class="text-lg font-semibold text-white flex items-center gap-2">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"></path>
       </svg> CRONOGRAMA DE ATIVIDADES</h3><button onclick="addRow()" class="no-print flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all hover:scale-105" style="background-color: #3b82f6; color: white;">
       <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
       </svg> Adicionar Linha </button>
     </div>
     <div class="overflow-x-auto">
      <table id="planoTabela" class="w-full">
       <thead>
        <tr style="background-color: #f1f5f9;">
         <th class="px-4 py-3 text-left text-sm font-semibold border-b-2" style="color: #1e3a5f; border-color: #e2e8f0; width: 15%;">PER√çODO</th>
         <th class="px-4 py-3 text-left text-sm font-semibold border-b-2" style="color: #1e3a5f; border-color: #e2e8f0; width: 10%;">CH</th>
         <th class="px-4 py-3 text-left text-sm font-semibold border-b-2" style="color: #1e3a5f; border-color: #e2e8f0; width: 35%;">A√á√ÉO A SER REALIZADA</th>
         <th class="px-4 py-3 text-left text-sm font-semibold border-b-2" style="color: #1e3a5f; border-color: #e2e8f0; width: 35%;">ESTRAT√âGIAS</th>
         <th class="px-4 py-3 text-center text-sm font-semibold border-b-2 no-print" style="color: #1e3a5f; border-color: #e2e8f0; width: 5%;">‚öôÔ∏è</th>
        </tr>
       </thead>
       <tbody id="table-body">
        <tr class="border-b hover:bg-gray-50 transition-colors" style="border-color: #e2e8f0;">
         <td class="px-4 py-3">
          <div contenteditable="true" class="editable-cell rounded-lg px-3 py-2" style="background-color: #f8fafc; color: #334155; min-height: 40px;" data-placeholder="Clique e digite a data" oninput="handleCellInput(event)" onblur="handleCellBlur(event)"></div></td>
         <td class="px-4 py-3">
          <div contenteditable="true" class="editable-cell rounded-lg px-3 py-2" style="background-color: #f8fafc; color: #334155; min-height: 40px;" data-placeholder="Clique e digite horas" oninput="handleCellInput(event)" onblur="handleCellBlur(event)"></div></td>
         <td class="px-4 py-3">
          <div contenteditable="true" class="editable-cell rounded-lg px-3 py-2 font-medium" style="background-color: #dbeafe; color: #1e40af; min-height: 40px;" data-placeholder="Clique para editar">
           ETAPA 01: ALINHAMENTO DA PROPOSTA
          </div></td>
         <td class="px-4 py-3">
          <div contenteditable="true" class="editable-cell rounded-lg px-3 py-2" style="background-color: #f8fafc; color: #334155; min-height: 40px;" data-placeholder="Clique para editar"></div></td>
         <td class="px-4 py-3 text-center no-print"><button onclick="deleteRow(this)" class="text-red-500 hover:text-red-700 hover:bg-red-50 p-2 rounded-lg transition-colors" title="Remover linha">üóëÔ∏è</button></td>
        </tr>
        <tr class="border-b hover:bg-gray-50 transition-colors" style="border-color: #e2e8f0;">
         <td class="px-4 py-3">
          <div contenteditable="true" class="editable-cell rounded-lg px-3 py-2" style="background-color: #f8fafc; color: #334155; min-height: 40px;" data-placeholder="Clique e digite a data" oninput="handleCellInput(event)" onblur="handleCellBlur(event)"></div></td>
         <td class="px-4 py-3">
          <div contenteditable="true" class="editable-cell rounded-lg px-3 py-2" style="background-color: #f8fafc; color: #334155; min-height: 40px;" data-placeholder="Clique e digite horas" oninput="handleCellInput(event)" onblur="handleCellBlur(event)"></div></td>
         <td class="px-4 py-3">
          <div contenteditable="true" class="editable-cell rounded-lg px-3 py-2 font-medium" style="background-color: #dcfce7; color: #166534; min-height: 40px;" data-placeholder="Clique para editar">
           ETAPA 02: DESENVOLVIMENTO
          </div></td>
         <td class="px-4 py-3">
          <div contenteditable="true" class="editable-cell rounded-lg px-3 py-2" style="background-color: #f8fafc; color: #334155; min-height: 40px;" data-placeholder="Clique para editar"></div></td>
         <td class="px-4 py-3 text-center no-print"><button onclick="deleteRow(this)" class="text-red-500 hover:text-red-700 hover:bg-red-50 p-2 rounded-lg transition-colors" title="Remover linha">üóëÔ∏è</button></td>
        </tr>
        <tr class="border-b hover:bg-gray-50 transition-colors" style="border-color: #e2e8f0;">
         <td class="px-4 py-3">
          <div contenteditable="true" class="editable-cell rounded-lg px-3 py-2" style="background-color: #f8fafc; color: #334155; min-height: 40px;" data-placeholder="Clique e digite a data" oninput="handleCellInput(event)" onblur="handleCellBlur(event)"></div></td>
         <td class="px-4 py-3">
          <div contenteditable="true" class="editable-cell rounded-lg px-3 py-2" style="background-color: #f8fafc; color: #334155; min-height: 40px;" data-placeholder="Clique e digite horas" oninput="handleCellInput(event)" onblur="handleCellBlur(event)"></div></td>
         <td class="px-4 py-3">
          <div contenteditable="true" class="editable-cell rounded-lg px-3 py-2 font-medium" style="background-color: #fef3c7; color: #92400e; min-height: 40px;" data-placeholder="Clique para editar">
           ETAPA 03: PROPOSI√á√ÉO DE MELHORIAS NOS PROCESSOS
          </div></td>
         <td class="px-4 py-3">
          <div contenteditable="true" class="editable-cell rounded-lg px-3 py-2" style="background-color: #f8fafc; color: #334155; min-height: 40px;" data-placeholder="Clique para editar"></div></td>
         <td class="px-4 py-3 text-center no-print"><button onclick="deleteRow(this)" class="text-red-500 hover:text-red-700 hover:bg-red-50 p-2 rounded-lg transition-colors" title="Remover linha">üóëÔ∏è</button></td>
        </tr>
       </tbody>
      </table>
     </div>
    </div><!-- Action Buttons -->
    <div class="no-print flex flex-wrap justify-center gap-4 mb-8"><button onclick="savePDF()" class="flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all hover:scale-105 hover:shadow-lg" style="background-color: #1e3a5f; color: white;">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
      </svg> Salvar como PDF </button>
    </div><!-- Footer -->
    <div class="text-center py-4" style="color: #94a3b8;">
     <p class="text-sm">Documento edit√°vel ‚Ä¢ Clique em qualquer campo para editar</p>
    </div>
   </div>
  </div>
  <script>
const defaultConfig = {
  document_title: 'PLANO DE A√á√ÉO',
  objective_text: 'Realizar plano de trabalho de atividades na empresa acordado entre as partes (prestadora de servi√ßo e empresa demandante).',
  primary_color: '#1e3a5f',
  secondary_color: '#3b82f6',
  background_color: '#f8fafc',
  surface_color: '#ffffff',
  text_color: '#334155'
};

let config = { ...defaultConfig };
let rowCounter = 3;

// Formatar data: 01011999 -> 01/01/1999
function formatDate(value) {
  const numbers = value.replace(/\D/g, '');
  
  if (numbers.length <= 2) return numbers;
  if (numbers.length <= 4) return numbers.slice(0, 2) + '/' + numbers.slice(2);
  return numbers.slice(0, 2) + '/' + numbers.slice(2, 4) + '/' + numbers.slice(4, 8);
}

// Formatar per√≠odo: pode ser uma data ou intervalo (DD/MM/YYYY a DD/MM/YYYY)
function formatPeriod(value) {
  // Extrair apenas n√∫meros
  const numbers = value.replace(/\D/g, '');
  
  // Se tem mais de 8 d√≠gitos, √© um intervalo
  if (numbers.length > 8) {
    // Dividir em duas datas: primeira 8 d√≠gitos, segunda 8 d√≠gitos
    const date1Nums = numbers.slice(0, 8);
    const date2Nums = numbers.slice(8, 16);
    
    let formatted1 = date1Nums.slice(0, 2) + '/' + date1Nums.slice(2, 4) + '/' + date1Nums.slice(4, 8);
    let formatted2 = '';
    
    if (date2Nums.length > 0) {
      formatted2 = date2Nums.slice(0, 2) + '/' + date2Nums.slice(2, 4) + '/' + date2Nums.slice(4, 8);
      return formatted1 + ' a ' + formatted2;
    }
    return formatted1;
  }
  
  // Caso contr√°rio, uma √∫nica data
  if (numbers.length <= 2) return numbers;
  if (numbers.length <= 4) return numbers.slice(0, 2) + '/' + numbers.slice(2);
  return numbers.slice(0, 2) + '/' + numbers.slice(2, 4) + '/' + numbers.slice(4, 8);
}

// Formatar horas: 08 -> 08h, 0830 -> 08:30h
function formatHours(value) {
  const numbers = value.replace(/\D/g, '');
  
  if (numbers.length === 0) return '';
  if (numbers.length <= 2) return numbers + 'h';
  if (numbers.length === 3) return numbers.slice(0, 1) + numbers.slice(1, 3) + 'h';
  return numbers.slice(0, 2) + ':' + numbers.slice(2, 4) + 'h';
}

// Lidar com ENTER no escopo para criar lista autom√°tica
function handleEscopoKeydown(e) {
  if (e.key === 'Enter') {
    e.preventDefault();
    const selection = window.getSelection();
    const range = selection.getRangeAt(0);
    
    // Criar novo par√°grafo com bullet point
    const newP = document.createElement('p');
    newP.textContent = '‚Ä¢ ';
    
    // Inserir ap√≥s o par√°grafo atual
    const currentP = range.commonAncestorContainer.nodeType === 3 
      ? range.commonAncestorContainer.parentElement 
      : range.commonAncestorContainer;
    
    if (currentP.tagName === 'P') {
      currentP.parentNode.insertBefore(newP, currentP.nextSibling);
    } else {
      e.target.appendChild(newP);
    }
    
    // Posicionar cursor ap√≥s o bullet
    const textNode = newP.firstChild;
    const newRange = document.createRange();
    newRange.setStart(textNode, 2);
    newRange.collapse(true);
    selection.removeAllRanges();
    selection.addRange(newRange);
  }
}

// Atualizar objetivo na config
function updateObjective(e) {
  const text = e.target.textContent.trim();
  config.objective_text = text;
  if (window.elementSdk) {
    window.elementSdk.setConfig({ objective_text: text });
  }
}

// Detectar tipo de campo e aplicar formata√ß√£o
function handleCellInput(e) {
  const cell = e.target;
  const row = cell.closest('tr');
  const cellIndex = Array.from(row.children).indexOf(cell.closest('td'));
  
  let text = cell.textContent;
  let formatted = text;
  
  // Coluna 0 = PER√çODO (data ou intervalo de datas)
  if (cellIndex === 0) {
    formatted = formatPeriod(text);
  }
  // Coluna 1 = CH (horas)
  else if (cellIndex === 1) {
    formatted = formatHours(text);
  }
  
  if (formatted !== text) {
    cell.textContent = formatted;
    // Mover cursor para o final
    const range = document.createRange();
    const sel = window.getSelection();
    range.selectNodeContents(cell);
    range.collapse(false);
    sel.removeAllRanges();
    sel.addRange(range);
  }
}

// Validar ao sair do campo
function handleCellBlur(e) {
  const cell = e.target;
  const row = cell.closest('tr');
  const cellIndex = Array.from(row.children).indexOf(cell.closest('td'));
  
  let text = cell.textContent.trim();
  
  // Validar per√≠odo: DD/MM/YYYY ou DD/MM/YYYY a DD/MM/YYYY
  if (cellIndex === 0) {
    const singleDateRegex = /^\d{2}\/\d{2}\/\d{4}$/;
    const rangeDateRegex = /^\d{2}\/\d{2}\/\d{4}\s+a\s+\d{2}\/\d{2}\/\d{4}$/;
    if (text && !singleDateRegex.test(text) && !rangeDateRegex.test(text)) {
      cell.textContent = '';
      showToast('‚ùå Digite os 16 d√≠gitos (8+8) para intervalo: 16092025a20102025');
    }
  }
  // Validar horas: HHh ou HH:MMh
  else if (cellIndex === 1) {
    const hoursRegex = /^(\d{2}h|(\d{2}:\d{2}h))$/;
    if (text && !hoursRegex.test(text)) {
      cell.textContent = '';
      showToast('‚ùå Hora inv√°lida. Use: 08h ou 08:30h');
    }
  }
}

const etapaColors = [
  { bg: '#dbeafe', text: '#1e40af' },
  { bg: '#dcfce7', text: '#166534' },
  { bg: '#fef3c7', text: '#92400e' },
  { bg: '#fce7f3', text: '#9d174d' },
  { bg: '#e0e7ff', text: '#3730a3' }
];

function addRow() {
  const tableBody = document.getElementById('table-body');
  const etapaNum = tableBody.children.length + 1;
  const colorIndex = (etapaNum - 1) % etapaColors.length;
  const color = etapaColors[colorIndex];
  
  const newRow = document.createElement('tr');
  newRow.className = 'border-b hover:bg-gray-50 transition-colors';
  newRow.style.borderColor = '#e2e8f0';
  
  newRow.innerHTML = `
    <td class="px-4 py-3"><div contenteditable="true" class="editable-cell rounded-lg px-3 py-2" style="background-color: #f8fafc; color: #334155; min-height: 40px;" data-placeholder="Clique e digite a data" oninput="handleCellInput(event)" onblur="handleCellBlur(event)"></div></td>
    <td class="px-4 py-3"><div contenteditable="true" class="editable-cell rounded-lg px-3 py-2" style="background-color: #f8fafc; color: #334155; min-height: 40px;" data-placeholder="Clique e digite horas" oninput="handleCellInput(event)" onblur="handleCellBlur(event)"></div></td>
    <td class="px-4 py-3"><div contenteditable="true" class="editable-cell rounded-lg px-3 py-2 font-medium" style="background-color: ${color.bg}; color: ${color.text}; min-height: 40px;" data-placeholder="Clique para editar">ETAPA ${String(etapaNum).padStart(2, '0')}: NOVA ETAPA</div></td>
    <td class="px-4 py-3"><div contenteditable="true" class="editable-cell rounded-lg px-3 py-2" style="background-color: #f8fafc; color: #334155; min-height: 40px;" data-placeholder="Clique para editar"></div></td>
    <td class="px-4 py-3 text-center no-print"><button onclick="deleteRow(this)" class="text-red-500 hover:text-red-700 hover:bg-red-50 p-2 rounded-lg transition-colors" title="Remover linha">üóëÔ∏è</button></td>
  `;
  
  tableBody.appendChild(newRow);
}

function deleteRow(button) {
  const row = button.closest('tr');
  const tableBody = document.getElementById('table-body');
  
  if (tableBody.children.length > 1) {
    row.style.opacity = '0';
    row.style.transform = 'translateX(-20px)';
    row.style.transition = 'all 0.3s ease';
    setTimeout(() => row.remove(), 300);
  } else {
    showToast('√â necess√°rio manter pelo menos uma linha na tabela.');
  }
}

function showToast(message) {
  const toast = document.createElement('div');
  toast.className = 'fixed bottom-4 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-xl shadow-lg z-50 transition-all';
  toast.style.backgroundColor = '#1e3a5f';
  toast.style.color = 'white';
  toast.textContent = message;
  document.body.appendChild(toast);
  
  setTimeout(() => {
    toast.style.opacity = '0';
    setTimeout(() => toast.remove(), 300);
  }, 3000);
}

async function savePDF() {
  showToast('Gerando PDF...');
  
  const noPrintElements = document.querySelectorAll('.no-print');
  noPrintElements.forEach(el => el.style.display = 'none');
  
  try {
    const { jsPDF } = window.jspdf;
    const element = document.getElementById('main-container');
    
    const canvas = await html2canvas(element, {
      scale: 2,
      allowTaint: true,
      useCORS: true,
      logging: false,
      backgroundColor: '#f8fafc',
      windowHeight: element.scrollHeight,
      windowWidth: element.scrollWidth
    });
    
    const imgData = canvas.toDataURL('image/png');
    const pdf = new jsPDF({
      orientation: 'p',
      unit: 'mm',
      format: 'a4'
    });
    
    const imgWidth = pdf.internal.pageSize.getWidth();
    const imgHeight = (canvas.height * imgWidth) / canvas.width;
    let heightLeft = imgHeight;
    let position = 0;
    
    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
    heightLeft -= pdf.internal.pageSize.getHeight();
    
    while (heightLeft > 0) {
      position = heightLeft - imgHeight;
      pdf.addPage();
      pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
      heightLeft -= pdf.internal.pageSize.getHeight();
    }
    
    const pdfBlob = pdf.output('blob');
    const url = URL.createObjectURL(pdfBlob);
    const link = document.createElement('a');
    link.href = url;
    link.download = 'plano_de_acao.pdf';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);
    
    showToast('‚úì PDF baixado com sucesso!');
  } catch (error) {
    console.error('Erro ao gerar PDF:', error);
    showToast('‚ùå Erro ao gerar PDF. Tente novamente.');
  } finally {
    noPrintElements.forEach(el => el.style.display = '');
  }
}

async function saveImage() {
  showToast('Gerando imagem...');
  
  const noPrintElements = document.querySelectorAll('.no-print');
  noPrintElements.forEach(el => el.style.display = 'none');
  
  try {
    const element = document.getElementById('main-container');
    
    const canvas = await html2canvas(element, {
      scale: 2,
      allowTaint: true,
      useCORS: true,
      logging: false,
      backgroundColor: '#f8fafc',
      windowHeight: element.scrollHeight,
      windowWidth: element.scrollWidth
    });
    
    const imgBlob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
    const url = URL.createObjectURL(imgBlob);
    const link = document.createElement('a');
    link.href = url;
    link.download = 'plano_de_acao.png';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);
    
    showToast('    Imagem baixada com sucesso!');
  } catch (error) {
    console.error('Erro ao gerar imagem:', error);
    showToast('‚ùå Erro ao gerar imagem. Tente novamente.');
  } finally {
    noPrintElements.forEach(el => el.style.display = '');
  }
}

async function onConfigChange(newConfig) {
  config = { ...defaultConfig, ...newConfig };
  
  document.getElementById('document-title').textContent = config.document_title || defaultConfig.document_title;
  document.getElementById('objective-text').textContent = config.objective_text || defaultConfig.objective_text;
}

function mapToCapabilities(cfg) {
  return {
    recolorables: [
      {
        get: () => cfg.background_color || defaultConfig.background_color,
        set: (value) => {
          cfg.background_color = value;
          if (window.elementSdk) window.elementSdk.setConfig({ background_color: value });
        }
      },
      {
        get: () => cfg.primary_color || defaultConfig.primary_color,
        set: (value) => {
          cfg.primary_color = value;
          if (window.elementSdk) window.elementSdk.setConfig({ primary_color: value });
        }
      },
      {
        get: () => cfg.secondary_color || defaultConfig.secondary_color,
        set: (value) => {
          cfg.secondary_color = value;
          if (window.elementSdk) window.elementSdk.setConfig({ secondary_color: value });
        }
      }
    ],
    borderables: [],
    fontEditable: undefined,
    fontSizeable: undefined
  };
}

function mapToEditPanelValues(cfg) {
  return new Map([
    ['document_title', cfg.document_title || defaultConfig.document_title],
    ['objective_text', cfg.objective_text || defaultConfig.objective_text]
  ]);
}

if (window.elementSdk) {
  window.elementSdk.init({
    defaultConfig,
    onConfigChange,
    mapToCapabilities,
    mapToEditPanelValues
  });
}
</script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9cd4d146a28f27e7',t:'MTc3MDk5MDg2NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>

</html>
